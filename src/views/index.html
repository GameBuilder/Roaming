<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>{{title}}</title>
  {{>globalhead}}
  {{{head}}}
</head>
<body>
<h1>{{title}}</h1>
<section id="main" class="panel">
  {{#user}}
  <h1>Welcome back {{name}}({{email}})</h1>
  <h3>Roles: {{keys roles}} </h3>

  <ul>
    <li><a href="/main">Main Page</a></li>
    <li><a href="/map">Editor</a></li>
  </ul>
  {{/user}}
  {{^user}}
  <h1 class="btn-browserid">Login Here</h1>
  
<form action="/auth/browserid" method="post" style="display:none;">
	<input type="text" name="assertion"/>
</form>

<img src="https://browserid.org/i/sign_in_red.png" class="btn-browserid"/>
{{/user}}
</section>  

<script src="vendor/require.js"></script>
<script>
require({
  baseUrl: '..',
  // configure our AMD loader
  paths: config.packages
}, ['$'], function($){

  // index/login route
  $(".btn-browserid").click(function(){
    navigator.id.getVerifiedEmail(function(assertion) {
      if (assertion) {
        $("input").val(assertion);
        $("form").submit();
      } else {
        location.reload();
      }
    });
  });

});
</script>
	<script src="https://browserid.org/include.js" type="text/javascript"></script>
  {{{end}}}
</body>
</html>