<!DOCTYPE html>
<html>
<head>
  <title>Test</title>

  <script src="./vendor/require.js"></script>
  <script src="./config.js"></script>

  <script type="text/javascript">
    (function(){
      // pull config from querystring
      var expectedKeys = { region: true };

      var queryStr = location.search.substring(1);
      var pairs, nameValue, params = {};
      if(queryStr){
        pairs = queryStr.split('&');
        for(var i=0; i<pairs.length; i++) {
          nameValue = pairs[i].split('=');
          if(nameValue[0] && (nameValue[0] in expectedKeys)){
            config[ nameValue[0] ] = nameValue[1];
          }
        }
      }
    })();

    var regionId = config.region || 'test';
    require([
      'knockout', 
      'lib/util', 
      'plugins/resource!region/'+regionId+'/index'
    ],function(ko, util, region) {
      
      var viewModel = {
        id: regionId,
        tiles: ko.observableArray([])
      };
      
      console.log("region: ", region);
      var ids = region.tiles.map(function(stub){
        return stub.x+','+stub.y;
      });
      
      region.loadTiles(ids).then(function(tiles){
        viewModel.tiles.splice.apply(viewModel.tiles, [0, tiles.length].concat(tiles));
      });

      ko.applyBindings(viewModel);
    });
  </script>
</head>

<body>

  <section id="main" class="panel">
    <h2>Region: <span data-bind="text: id"></span></h2>
    <ul data-bind="foreach: tiles">
      <li>
        <h2>Location: <span data-bind="text: id"></span></h2>
        <dl>
          <dt>Region:</dt>
          <dd data-bind="text: regionId"></dd>
          <dt>Type:</dt>
          <dd data-bind="text: type"></dd>
          <dt>Description:</dt>
          <dd data-bind="text: description"></dd>
        </dl>
        <h2>Here</h2>

        <ul data-bind="foreach: here">
          <li>Item</li>
        </ul>
        <h2>Encounter</h2>
        <div data-bind="if: encounter && encounterType =='npc'">
          NPC Encounter data
          <ul data-bind="foreach: encounter.npc">
            <li data-bind="text: type"></li>
          </ul>
        </div>
      </li>
    </ul>
  </section>  

</body>
</html>
